<!DOCTYPE html>
<html>
  <head>
    <title>layout comparison</title>
    <script type="text/javascript" src="../staging/bbop.js"></script>
    <script type="text/javascript" src="../lib/bbop/model/tree.js"></script>
    <script type="text/javascript" src="../lib/graph/render/phylo-div.js"></script>
    <script type="text/javascript" src="global_graph_P34889.js"></script>

    <script type="text/javascript">
      var bbop_layout;
      var mitch_layout;

      window.onload = function() {
        var node_cache_hash = {};

        var bbop_tree = new bbop.model.tree.graph();
        var mitch_tree = new bbop.render.phylo.tree();

        var nodes = global_graph.nodes;
        var edges = global_graph.edges;
        console.log(nodes.length + " nodes");
        console.log(edges.length + " edges");
    
        for (var i = 0; i < nodes.length; i++) {
          mitch_tree.add_node(nodes[i].id, nodes[i].id);

          var new_node = new bbop.model.tree.node(nodes[i].id, nodes[i].id);
          node_cache_hash[nodes[i].id] = new_node;
          bbop_tree.add_node(new_node);
        }

        for (var i = 0; i < edges.length; i++) {
          mitch_tree.add_edge(edges[i].sub, edges[i].obj, parseFloat(edges[i].meta));
          var n1 = node_cache_hash[edges[i].sub];
          var n2 = node_cache_hash[edges[i].obj];
          if( n1 && n2 ){
            var new_edge = new bbop.model.tree.edge(n1, n2, parseFloat(edges[i].meta));
            bbop_tree.add_edge(new_edge);
          }else{
            throw "node not found";
          }
        }

        console.profile();

        var mitch_start = performance.now();

        mitch_tree.sort_children(function(a, b) {
          if( a.id == b.id ) return 0;
          return (a.id < b.id) ? -1 : 1;
        });
        mitch_layout = mitch_tree.layout();

        var mitch_time = performance.now() - mitch_start;

        var bbop_start = performance.now();

        bbop_layout = bbop_tree.layout();

        var bbop_time = performance.now() - bbop_start;

        console.profileEnd();

        document.write("mitch time: " + mitch_time.toFixed(3) + " ms<br>");
        document.write("bbop time: " + bbop_time.toFixed(3) + " ms<br>");
        document.write('max X difference: <span id="max_xdiff"></span><br>');
        document.write('max Y difference: <span id="max_ydiff"></span><br>');
        document.write('<table border=1><tr><th>node id</th><th>bbop x</th><th>mitch x</th><th>bbop y</th><th>mitch y</th></tr>');

        var max_xdiff = 0;
        var max_ydiff = 0;
        for (var i = 0; i < mitch_layout.length; i++) {
            var mitchx = mitch_layout[i].x;
            var mitchy = mitch_layout[i].y;
            var bbopx = bbop_layout.position_x[mitch_layout[i].id];
            var bbopy = bbop_layout.position_y[mitch_layout[i].id];

            var xdiff = Math.abs(mitchx - bbopx);
            max_xdiff = Math.max(max_xdiff, xdiff);
            var ydiff = Math.abs(mitchy - bbopy);
            max_ydiff = Math.max(max_ydiff, ydiff);
            document.write(
              "<tr><td>" + mitch_layout[i].id + "</td>"
              + "<td>" + bbopx + "</td>"
              + "<td>" + mitchx + "</td>"
              + "<td>" + bbopy + "</td>"
              + "<td>" + mitchy + "</td>"
              + "</tr>");
        }
        document.write("</table>");
        document.getElementById("max_xdiff").appendChild(document.createTextNode(max_xdiff));
        document.getElementById("max_ydiff").appendChild(document.createTextNode(max_ydiff));
      };
    </script>
  </head>
  <body style="border: 0px; margin: 0px; padding: 0px;">
  </body>
</html>
